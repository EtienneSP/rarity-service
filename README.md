# Rarity Service

## Basic Setup
  - To use this project, you must have a BlockFrost API key, that is added to some request in their query parameter.
  - You must also have a running instance of MongoDB. It's location can be edited in the "app-config.ts" file.
  - To run the app (from the root folder of this project):
    - run "tsc" to compile typescript
    - run "node ."

## How to use
This API can be consume by any other API, client application, or dev tools like Postman.
1. Add a Template
    
    `POST => localhost:5001/templates`
    
    Example of payload for /templates POST request:
    ```
    {
        "policyId": "40fa2aa67258b4ce7b5782f74831d46a84c59a0ff0c28262fab21728",
        "attributeKeyAndPath": {
          "body": "body",
          "eyes": "eyes",
          "brows": "brows",
          "mouth": "mouth",
          "clothes": "clothes",
          "background": "background",
          "accessories": "accessories",
          "hats and hair": "hats and hair",
          "wings": "wings"
        }
    }
    ```
2. Call the Generate enpoint with the parameters for the collection you want to generate the rarity.

    Note, you must have a blockfrost api key to use this endpoint. Replace "YOUR_BLOCKFROST_API_KEY" by your own API key.
    
    `GET => localhost:5001/rarity?policy-id=40fa2aa67258b4ce7b5782f74831d46a84c59a0ff0c28262fab21728&project-name=ClayNation&project-id={YOUR_BLOCKFROST_API_KEY}&page-limit=150`

    Note that the generation of rarity for a 10 000 asset project takes around 20 minutes.

3. A project object is created when the rarity generation finish

    `GET => localhost:5001/projects`

4. Every Assets are available, with their associated rarity (you can also explore them directly in MongoDB since no search endpoint are available yet)
    
    Display every assets for a policyId:
    
    `GET => localhost:5001/assets/policy-id/40fa2aa67258b4ce7b5782f74831d46a84c59a0ff0c28262fab21728`

    Display one asset, based on his assetId (on the Cardano blockchain):

    `GET => localhost:5001/assets/fingerprint/asset1pdp99j6n44nd93u6sdnt3fn0mprkdg9h8zw96s`


## Model Definition
### Asset
Asset data generated by the API. This is the final product of this API. The asset will be linked to a Project via it's policyId. The asset will have a rarity object associated to it, displaying it's score, rank in the collection and rarity of all it's attributes.

### Blockfrost-Asset
Asset data, exactly as returned by blockfrost.
This act like a cache, and avoid the need to requery the complete collection every time the rarity for this collection is generated.

### Project
Returns the high level definition of an NFT project. The project is available after the rarity has been processed for a collection, and will contain the weight of every properties for the project.

### Template
Mapping, defined by the user, telling what properties must be considered to genrate the rarity of a given policyId.
